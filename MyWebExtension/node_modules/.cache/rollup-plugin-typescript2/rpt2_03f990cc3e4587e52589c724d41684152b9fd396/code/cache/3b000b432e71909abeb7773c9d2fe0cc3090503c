{"code":"import { __awaiter, __decorate, __extends, __generator } from \"tslib\";\r\nimport { BaseControl, BaseControlParams } from \"@docsvision/webclient/System/BaseControl\";\r\nimport { ControlImpl } from \"@docsvision/webclient/System/ControlImpl\";\r\nimport { r } from \"@docsvision/webclient/System/Readonly\";\r\nimport React from \"react\";\r\nimport { Button, ButtonAlignModes } from \"@docsvision/webclient/Helpers/Button\";\r\nvar CheapTicketsControlParams = /** @class */ (function (_super) {\r\n    __extends(CheapTicketsControlParams, _super);\r\n    function CheapTicketsControlParams() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    __decorate([\r\n        r\r\n    ], CheapTicketsControlParams.prototype, \"services\", void 0);\r\n    __decorate([\r\n        r\r\n    ], CheapTicketsControlParams.prototype, \"GetCheapTicketsLabel\", void 0);\r\n    __decorate([\r\n        r\r\n    ], CheapTicketsControlParams.prototype, \"getCheapTicketsLabel\", void 0);\r\n    return CheapTicketsControlParams;\r\n}(BaseControlParams));\r\nexport { CheapTicketsControlParams };\r\nvar CheapTicketsControl = /** @class */ (function (_super) {\r\n    __extends(CheapTicketsControl, _super);\r\n    function CheapTicketsControl() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    CheapTicketsControl.prototype.construct = function () {\r\n        _super.prototype.construct.call(this);\r\n        this.state.tickets = null;\r\n        this.state.isExpanded = false;\r\n        this.state.selectedTicketIndex = null;\r\n        this.state.selectedTicketPrice = null;\r\n        this.state.isLoading = false;\r\n    };\r\n    CheapTicketsControl.prototype.createParams = function () {\r\n        return new CheapTicketsControlParams();\r\n    };\r\n    CheapTicketsControl.prototype.createImpl = function () {\r\n        return new ControlImpl(this.props, this.state, this.renderControl.bind(this));\r\n    };\r\n    CheapTicketsControl.prototype.onButtonClick = function () {\r\n        var _a, _b, _c, _d, _e, _f, _g;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var dateFrom, dateTo, departure_at_format, return_at_format, cityName, tickets, error_1;\r\n            return __generator(this, function (_h) {\r\n                switch (_h.label) {\r\n                    case 0:\r\n                        console.log(this.params.getCheapTicketsLabel);\r\n                        console.log(this.params.GetCheapTicketsLabel);\r\n                        dateFrom = (_b = (_a = this.layout.controls.tryGet(\"dateFrom\")) === null || _a === void 0 ? void 0 : _a.params) === null || _b === void 0 ? void 0 : _b.value;\r\n                        dateTo = (_d = (_c = this.layout.controls.tryGet(\"dateTo\")) === null || _c === void 0 ? void 0 : _c.params) === null || _d === void 0 ? void 0 : _d.value;\r\n                        departure_at_format = dateFrom ? dateFrom.toISOString().split('T')[0] : null;\r\n                        return_at_format = dateTo ? dateTo.toISOString().split('T')[0] : null;\r\n                        cityName = ((_g = (_f = (_e = this.layout.controls.tryGet(\"city\")) === null || _e === void 0 ? void 0 : _e.params) === null || _f === void 0 ? void 0 : _f.value) === null || _g === void 0 ? void 0 : _g.name) || null;\r\n                        if (!cityName) {\r\n                            alert(\"Пожалуйста, выберите город\");\r\n                            return [2 /*return*/];\r\n                        }\r\n                        this.setState({ isLoading: true });\r\n                        _h.label = 1;\r\n                    case 1:\r\n                        _h.trys.push([1, 3, , 4]);\r\n                        return [4 /*yield*/, this.params.services.activityPlanService.GetCheapTickets({\r\n                                city: cityName,\r\n                                departure_at: departure_at_format,\r\n                                return_at: return_at_format\r\n                            })];\r\n                    case 2:\r\n                        tickets = _h.sent();\r\n                        if ((tickets === null || tickets === void 0 ? void 0 : tickets.success) && tickets.data && tickets.data.length > 0) {\r\n                            tickets.data.sort(function (a, b) { return parseInt(a.price) - parseInt(b.price); });\r\n                            this.setState({\r\n                                tickets: tickets,\r\n                                isExpanded: true,\r\n                                isLoading: false\r\n                            });\r\n                        }\r\n                        else {\r\n                            alert(\"Билеты по указанным параметрам не найдены\");\r\n                            this.setState({\r\n                                tickets: null,\r\n                                isExpanded: true,\r\n                                selectedTicketIndex: null,\r\n                                selectedTicketPrice: null,\r\n                                isLoading: false\r\n                            });\r\n                        }\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        error_1 = _h.sent();\r\n                        alert(\"Ошибка при получении данных о билетах\");\r\n                        this.setState({\r\n                            tickets: null,\r\n                            isExpanded: false,\r\n                            selectedTicketIndex: null,\r\n                            selectedTicketPrice: null,\r\n                            isLoading: false\r\n                        });\r\n                        return [3 /*break*/, 4];\r\n                    case 4: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    CheapTicketsControl.prototype.onTicketSelect = function (event) {\r\n        var _a, _b;\r\n        var selectedIndex = parseInt(event.target.value);\r\n        if (selectedIndex >= 0 && ((_b = (_a = this.state.tickets) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b[selectedIndex])) {\r\n            var selectedTicket = this.state.tickets.data[selectedIndex];\r\n            this.setState({\r\n                selectedTicketIndex: selectedIndex,\r\n                selectedTicketPrice: selectedTicket.price\r\n            });\r\n        }\r\n        else {\r\n            this.setState({\r\n                selectedTicketIndex: null,\r\n                selectedTicketPrice: null\r\n            });\r\n        }\r\n    };\r\n    CheapTicketsControl.prototype.formatTicketOption = function (ticket, index) {\r\n        var airline = ticket.airline || \"Неизвестная авиакомпания\";\r\n        var flightNumber = ticket.flight_Number || \"Н/Д\";\r\n        return airline + \" (\\u0420\\u0435\\u0439\\u0441 \" + flightNumber + \")\";\r\n    };\r\n    CheapTicketsControl.prototype.renderControl = function () {\r\n        var _this = this;\r\n        var _a, _b;\r\n        return (React.createElement(\"div\", { style: { margin: \"10px 0\" } },\r\n            React.createElement(Button, { text: this.state.isLoading ? \"Поиск билетов...\" : \"Запросить стоимость билетов\", align: ButtonAlignModes.Center, onClick: function () { return _this.onButtonClick(); }, disabled: this.state.isLoading }),\r\n            this.state.isExpanded && (React.createElement(\"div\", { style: {\r\n                    marginTop: \"15px\",\r\n                    padding: \"15px\",\r\n                    border: \"1px solid #ddd\",\r\n                    borderRadius: \"5px\",\r\n                    backgroundColor: \"#f9f9f9\"\r\n                } }, ((_a = this.state.tickets) === null || _a === void 0 ? void 0 : _a.data) && this.state.tickets.data.length > 0 ? (React.createElement(\"div\", { style: { marginBottom: \"15px\" } },\r\n                React.createElement(\"label\", { htmlFor: \"ticketSelector\", style: {\r\n                        display: \"block\",\r\n                        marginBottom: \"8px\",\r\n                        fontWeight: \"bold\",\r\n                        fontSize: \"14px\"\r\n                    } }, \"\\u0412\\u0430\\u0440\\u0438\\u0430\\u043D\\u0442\\u044B \\u0431\\u0438\\u043B\\u0435\\u0442\\u043E\\u0432:\"),\r\n                React.createElement(\"select\", { id: \"ticketSelector\", style: {\r\n                        width: \"100%\",\r\n                        padding: \"10px\",\r\n                        border: \"1px solid #ccc\",\r\n                        borderRadius: \"4px\",\r\n                        fontSize: \"14px\",\r\n                        backgroundColor: \"white\"\r\n                    }, value: (_b = this.state.selectedTicketIndex) !== null && _b !== void 0 ? _b : \"\", onChange: function (e) { return _this.onTicketSelect(e); } },\r\n                    React.createElement(\"option\", { value: \"\" }, \"-- \\u0412\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0431\\u0438\\u043B\\u0435\\u0442 --\"),\r\n                    this.state.tickets.data.map(function (ticket, index) { return (React.createElement(\"option\", { key: index, value: index }, _this.formatTicketOption(ticket, index))); })))) : (\r\n            /* Сообщение, если билеты не найдены */\r\n            React.createElement(\"div\", { style: {\r\n                    padding: \"15px\",\r\n                    textAlign: \"center\",\r\n                    color: \"#666\",\r\n                    fontStyle: \"italic\"\r\n                } }, \"\\u0411\\u0438\\u043B\\u0435\\u0442\\u044B \\u043F\\u043E \\u0443\\u043A\\u0430\\u0437\\u0430\\u043D\\u043D\\u044B\\u043C \\u043F\\u0430\\u0440\\u0430\\u043C\\u0435\\u0442\\u0440\\u0430\\u043C \\u043D\\u0435 \\u043D\\u0430\\u0439\\u0434\\u0435\\u043D\\u044B\")))),\r\n            this.state.selectedTicketPrice != null && (React.createElement(\"div\", { style: {\r\n                    marginTop: \"10px\",\r\n                    padding: \"10px\",\r\n                    backgroundColor: \"#e8f5e8\",\r\n                    border: \"1px solid #4caf50\",\r\n                    borderRadius: \"4px\",\r\n                    fontWeight: \"bold\"\r\n                } },\r\n                this.params.GetCheapTicketsLabel,\r\n                \"  \",\r\n                this.state.selectedTicketPrice,\r\n                \" \\u0440\\u0443\\u0431.\"))));\r\n    };\r\n    return CheapTicketsControl;\r\n}(BaseControl));\r\nexport { CheapTicketsControl };\r\n//# sourceMappingURL=СheapTicketsControl.js.map","references":["D:/Desktop/DocsvisionHomeWork/MyWebExtension/node_modules/@docsvision/webclient/System/BaseControl.d.ts","D:/Desktop/DocsvisionHomeWork/MyWebExtension/node_modules/@docsvision/webclient/System/ControlImpl.d.ts","D:/Desktop/DocsvisionHomeWork/MyWebExtension/node_modules/@docsvision/webclient/System/Readonly.d.ts","D:/Desktop/DocsvisionHomeWork/MyWebExtension/node_modules/@types/react/index.d.ts","D:/Desktop/DocsvisionHomeWork/MyWebExtension/node_modules/@docsvision/webclient/System/LayoutServices.d.ts","D:/Desktop/DocsvisionHomeWork/MyWebExtension/node_modules/@docsvision/webclient/Helpers/Button.d.ts","D:/Desktop/DocsvisionHomeWork/MyWebExtension/src/Models/IApiResponse.ts","D:/Desktop/DocsvisionHomeWork/MyWebExtension/src/Services/Interfaces/IReqService.ts","D:/Desktop/DocsvisionHomeWork/MyWebExtension/node_modules/@docsvision/webclient/Platform/DateTimePicker.d.ts","D:/Desktop/DocsvisionHomeWork/MyWebExtension/node_modules/@docsvision/webclient/BackOffice/DirectoryDesignerRow.d.ts"],"map":"{\"version\":3,\"file\":\"СheapTicketsControl.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/Controls/СheapTicketsControl.tsx\"],\"names\":[],\"mappings\":\"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\"}"}
