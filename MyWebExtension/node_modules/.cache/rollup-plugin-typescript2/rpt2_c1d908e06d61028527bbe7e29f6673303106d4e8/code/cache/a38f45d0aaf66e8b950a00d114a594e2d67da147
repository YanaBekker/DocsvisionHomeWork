{"code":"import { __awaiter, __generator } from \"tslib\";\r\nimport { MessageBox } from \"@docsvision/webclient/Helpers/MessageBox/MessageBox\";\r\nimport { $MessageBox } from \"@docsvision/webclient/System/$MessageBox\";\r\nimport { $ReqService } from \"../Services/Interfaces/IReqService\";\r\nvar RequestBusinessTripLogic = /** @class */ (function () {\r\n    function RequestBusinessTripLogic() {\r\n    }\r\n    /**\r\n     * Проверяет возможность сохранения карточки для поля основание для поездки\r\n     * @param layout Разметка карточки\r\n     * @returns true если сохранение разрешено, false если запрещено\r\n    */\r\n    RequestBusinessTripLogic.prototype.CheckPossibility = function (layout) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var tripReasonField, tripReasonValue;\r\n            return __generator(this, function (_a) {\r\n                tripReasonField = layout.controls.tryGet(\"description\");\r\n                if (!tripReasonField) {\r\n                    console.warn(\"Контролы описания не найдены\");\r\n                    return [2 /*return*/];\r\n                }\r\n                tripReasonValue = tripReasonField.value;\r\n                if (!tripReasonValue || tripReasonValue.toString().trim() === \"\") {\r\n                    MessageBox.ShowWarning(\"Сохранение отклонено: поле основание для поездки должно быть заполнено\");\r\n                    return [2 /*return*/, false];\r\n                }\r\n                return [2 /*return*/, true];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Проверяет валидность дат: дата начала < даты окончания поездки\r\n     * @param layout Разметка карточки\r\n     * @returns true если дата начала < даты окончания поездки, false если дата начала >= даты окончания поездки\r\n    */\r\n    RequestBusinessTripLogic.prototype.CheckDateTrip = function (sender) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var layout, startDateControl, endDateControl, startDateValue, endDateValue;\r\n            return __generator(this, function (_a) {\r\n                layout = sender.layout;\r\n                startDateControl = layout.controls.tryGet(\"dateFrom\");\r\n                endDateControl = layout.controls.tryGet(\"dateTo\");\r\n                if (!startDateControl || !endDateControl) {\r\n                    console.warn(\"Контролы дат не найдены\");\r\n                    return [2 /*return*/];\r\n                }\r\n                startDateValue = startDateControl.params.value;\r\n                endDateValue = endDateControl.params.value;\r\n                if (!startDateValue || !endDateValue) {\r\n                    return [2 /*return*/];\r\n                }\r\n                if (endDateValue < startDateValue) {\r\n                    startDateControl.params.value = new Date();\r\n                    endDateControl.params.value = new Date();\r\n                    MessageBox.ShowWarning(\"Ошибка с датами: дата начала командировки не может быть позже даты окончания\");\r\n                }\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Отображает информацию о карточке\r\n     * @param layout Разметка карточки\r\n    */\r\n    RequestBusinessTripLogic.prototype.showInformation = function (sender) {\r\n        var _a, _b, _c, _d, _e, _f;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var docName, regDate, dateFrom, dateTo, reason, city, formatDate, stripHtml, lines;\r\n            return __generator(this, function (_g) {\r\n                switch (_g.label) {\r\n                    case 0:\r\n                        docName = ((_a = sender.layout.controls.tryGet(\"documentName\").params) === null || _a === void 0 ? void 0 : _a.value) || \"Не указано\";\r\n                        regDate = ((_b = sender.layout.controls.tryGet(\"regDate\").params) === null || _b === void 0 ? void 0 : _b.value) || \"Не указана\";\r\n                        dateFrom = ((_c = sender.layout.controls.tryGet(\"dateFrom\").params) === null || _c === void 0 ? void 0 : _c.value) || \"Не указана\";\r\n                        dateTo = ((_d = sender.layout.controls.tryGet(\"dateTo\").params) === null || _d === void 0 ? void 0 : _d.value) || \"Не указана\";\r\n                        reason = ((_e = sender.layout.controls.tryGet(\"description\").params) === null || _e === void 0 ? void 0 : _e.value) || \"Не указано\";\r\n                        city = ((_f = sender.layout.controls.tryGet(\"city\").params.value) === null || _f === void 0 ? void 0 : _f.name) || \"Не указано\";\r\n                        formatDate = function (dateValue) {\r\n                            if (!dateValue || dateValue === \"Не указана\")\r\n                                return dateValue;\r\n                            var date = new Date(dateValue);\r\n                            return date.toLocaleDateString('ru-RU', {\r\n                                day: '2-digit',\r\n                                month: '2-digit',\r\n                                year: 'numeric',\r\n                                hour: '2-digit',\r\n                                minute: '2-digit'\r\n                            });\r\n                        };\r\n                        stripHtml = function (html) {\r\n                            if (!html || html === \"Не указано\")\r\n                                return html;\r\n                            return html.replace(/<[^>]*>/g, '');\r\n                        };\r\n                        lines = [\r\n                            \"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u0434\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u0430: \" + docName,\r\n                            \"\\u0414\\u0430\\u0442\\u0430 \\u0441\\u043E\\u0437\\u0434\\u0430\\u043D\\u0438\\u044F: \" + formatDate(regDate),\r\n                            \"\\u0414\\u0430\\u0442\\u0430 \\u0441: \" + formatDate(dateFrom),\r\n                            \"\\u0414\\u0430\\u0442\\u0430 \\u043F\\u043E: \" + formatDate(dateTo),\r\n                            \"\\u041E\\u0441\\u043D\\u043E\\u0432\\u0430\\u043D\\u0438\\u0435: \" + stripHtml(reason),\r\n                            \"\\u0413\\u043E\\u0440\\u043E\\u0434: \" + city\r\n                        ].filter(Boolean).join('\\n');\r\n                        return [4 /*yield*/, MessageBox.ShowInfo(lines)];\r\n                    case 1:\r\n                        _g.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RequestBusinessTripLogic.prototype.performAction = function (layout) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var response;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, layout.getService($ReqService).GetReqName(layout.cardInfo.id)];\r\n                    case 1:\r\n                        response = _a.sent();\r\n                        layout.getService($MessageBox).showInfo(response);\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RequestBusinessTripLogic.prototype.ChangeDirPhoneInfo = function (layout) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var commander, value, result;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        commander = layout.controls.tryGet(\"commander\");\r\n                        value = commander.value;\r\n                        return [4 /*yield*/, layout.getService($ReqService).ChangeDirPhoneInfo({ documentId: layout.cardInfo.id,\r\n                                commanderId: value.id })];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        // Пыталась возвращать строку телефона и в какой либо виде данные о руководителе (id, типы и еще разные типы)\r\n                        // и меня значения тут  const phone = sender.layout.controls.tryGet<TextBox>(\"phone\"); phone.params.value = то что вернули\r\n                        // но вот не смогал сотрудника вернуть\r\n                        layout.reloadFromServer();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    RequestBusinessTripLogic.prototype.ChangeCityInfo = function (layout) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var cityNode, day, result, sumTrip;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        cityNode = layout.controls.tryGet(\"city\");\r\n                        day = layout.controls.tryGet(\"dayCount\");\r\n                        return [4 /*yield*/, layout.getService($ReqService).ChangeCityInfo({ documentId: layout.cardInfo.id,\r\n                                daysCount: day.value, city: cityNode.value.name })];\r\n                    case 1:\r\n                        result = _a.sent();\r\n                        sumTrip = layout.controls.tryGet(\"sumTrip\");\r\n                        sumTrip.params.value = result.amountMoney;\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return RequestBusinessTripLogic;\r\n}());\r\nexport { RequestBusinessTripLogic };\r\n//# sourceMappingURL=RequestBusinessTripLogic.js.map","references":["D:/Desktop/Новая папка (2)/MyWebExtension/node_modules/@docsvision/webclient/System/$Layout.d.ts","D:/Desktop/Новая папка (2)/MyWebExtension/node_modules/@docsvision/webclient/System/CancelableEventArgs.d.ts","D:/Desktop/Новая папка (2)/MyWebExtension/node_modules/@docsvision/webclient/System/ICardSavingEventArgs.d.ts","D:/Desktop/Новая папка (2)/MyWebExtension/node_modules/@docsvision/webclient/System/Layout.d.ts","D:/Desktop/Новая папка (2)/MyWebExtension/node_modules/@docsvision/webclient/BackOffice/DirectoryDesignerRow.d.ts","D:/Desktop/Новая папка (2)/MyWebExtension/node_modules/@docsvision/webclient/Generated/DocsVision.WebClient.Models.d.ts","D:/Desktop/Новая папка (2)/MyWebExtension/node_modules/@docsvision/webclient/BackOffice/StaffDirectoryItems.d.ts","D:/Desktop/Новая папка (2)/MyWebExtension/node_modules/@docsvision/webclient/Platform/TextArea.d.ts","D:/Desktop/Новая папка (2)/MyWebExtension/node_modules/@docsvision/webclient/Platform/DateTimePicker.d.ts","D:/Desktop/Новая папка (2)/MyWebExtension/node_modules/@docsvision/webclient/Platform/Number.d.ts","D:/Desktop/Новая папка (2)/MyWebExtension/node_modules/@docsvision/webclient/Helpers/MessageBox/MessageBox.d.ts","D:/Desktop/Новая папка (2)/MyWebExtension/node_modules/@docsvision/webclient/Generated/DocsVision.WebClient.Controllers.d.ts","D:/Desktop/Новая папка (2)/MyWebExtension/node_modules/@docsvision/webclient/Platform/TextBox.d.ts","D:/Desktop/Новая папка (2)/MyWebExtension/node_modules/@docsvision/webclient/Platform/CustomButton.d.ts","D:/Desktop/Новая папка (2)/MyWebExtension/node_modules/@docsvision/webclient/System/$MessageBox.d.ts","D:/Desktop/Новая папка (2)/MyWebExtension/src/Services/Interfaces/IReqService.ts","D:/Desktop/Новая папка (2)/MyWebExtension/node_modules/@docsvision/webclient/BackOffice/ChildTasksPerforming.d.ts"],"map":"{\"version\":3,\"file\":\"RequestBusinessTripLogic.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/Logic/RequestBusinessTripLogic.ts\"],\"names\":[],\"mappings\":\"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\"}"}
